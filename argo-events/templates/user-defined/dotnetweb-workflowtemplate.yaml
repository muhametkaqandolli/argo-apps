apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: dotnet-webapp-image
  namespace: argo
spec:
  templates:
    - name: build-dotnet-webapp
      inputs:
        parameters:
          - name: app_repo
            value: git://github.com/muhametkaqandolli/dotnet-webapp.git
          - name: container_image
            value: memikaqandolli/dotnet-webapp
          - name: container_tag
            value: latest
      container:
        name: build-dotnet-webapp-container
        image: gcr.io/kaniko-project/executor:debug
        command:
          - /kaniko/executor
        args:
          - '--dockerfile=/dotnet-webapp/Dockerfile'
          - '--context={{inputs.parameters.app_repo}}'
          - >-
            --destination={{inputs.parameters.container_image}}:{{inputs.parameters.container_tag}}
        volumeMounts:
          - name: kaniko-secret
            mountPath: /kaniko/.docker
      volumes:
        - name: kaniko-secret
          secret:
            secretName: regcred
            items:
              - key: .dockerconfigjson
                path: config.json
